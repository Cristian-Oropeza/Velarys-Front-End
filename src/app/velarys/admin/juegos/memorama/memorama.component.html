<!-- Header -->
<div class="header">
  <div class="logo">
    <img src="assets/logo.jpg" alt="Logo">
  </div>
  <div class="title">
    <h1>Memoramas - Administrador</h1>
  </div>
  <div class="actions">
    <button (click)="volver()" class="btn-cerrar-sesion">Volver</button>
  </div>
</div>

<!-- Error Message -->
<div *ngIf="errorMensaje" class="error-message">{{ errorMensaje }}</div>

<!-- Formulario para crear un nuevo memorama -->
<div class="form-container" *ngIf="!memoramaEditada">
  <h2>Crear Memorama</h2>
  <form [formGroup]="nuevaMemoramaForm" (ngSubmit)="crearMemorama()">
    <label for="nombre">Nombre:</label>
    <input id="nombre" formControlName="nombre" type="text">
    <div *ngIf="nuevaMemoramaForm.get('nombre')?.invalid && nuevaMemoramaForm.get('nombre')?.touched" class="error-message">
      El nombre es requerido.
    </div>

    <label for="descripcion">Descripción:</label>
    <input id="descripcion" formControlName="descripcion" type="text">
    <div *ngIf="nuevaMemoramaForm.get('descripcion')?.invalid && nuevaMemoramaForm.get('descripcion')?.touched" class="error-message">
      La descripción es requerida.
    </div>

    <input type="hidden" formControlName="leccionId" [value]="leccionId">

    <button type="submit" [disabled]="nuevaMemoramaForm.invalid">Crear Memorama</button>
  </form>
</div>

<!-- Lista de memoramas -->
<div class="memorama-list-container">
  <h2>Memoramas Existentes</h2>
  <ul class="memorama-list">
    <li *ngFor="let memorama of memoramas">
      <span>{{ memorama.nombre }}</span>
      <div class="actions">
        <button (click)="seleccionarMemorama(memorama)">Editar</button>
        <button (click)="eliminarMemorama(memorama.id ?? 0)">Eliminar</button>
      </div>
    </li>
  </ul>
</div>

<!-- Sección de edición de memorama y manejo de cartas -->
<div *ngIf="memoramaEditada" class="edit-container">
  <!-- Formulario para editar memorama -->
  <div class="form-container">
    <h2>Editar Memorama</h2>
    <form [formGroup]="memoramaEditadaForm" (ngSubmit)="editarMemorama()">
      <label for="nombreEditado">Nombre:</label>
      <input id="nombreEditado" formControlName="nombre" type="text">
      <div *ngIf="memoramaEditadaForm.get('nombre')?.invalid && memoramaEditadaForm.get('nombre')?.touched" class="error-message">
        El nombre es requerido.
      </div>

      <label for="descripcionEditado">Descripción:</label>
      <input id="descripcionEditado" formControlName="descripcion" type="text">
      <div *ngIf="memoramaEditadaForm.get('descripcion')?.invalid && memoramaEditadaForm.get('descripcion')?.touched" class="error-message">
        La descripción es requerida.
      </div>

      <div class="button-group">
        <button type="submit" [disabled]="memoramaEditadaForm.invalid">Actualizar Memorama</button>
        <button type="button" (click)="cancelarEdicion()">Cancelar</button>
      </div>
    </form>
  </div>

  <!-- Formulario para crear o editar carta -->
  <div class="form-container" *ngIf="!cartaEditada">
    <h2>Crear Carta</h2>
    <form [formGroup]="cartaForm" (ngSubmit)="crearCarta()">
      <label for="valor">Valor:</label>
      <input id="valor" formControlName="valor" type="text">
      <div *ngIf="cartaForm.get('valor')?.invalid && cartaForm.get('valor')?.touched" class="error-message">
        El valor es requerido.
      </div>

      <label for="estado">Estado:</label>
      <select id="estado" formControlName="estado">
        <option value="cerrado">Cerrado</option>
        <option value="abierto">Abierto</option>
      </select>
      <div *ngIf="cartaForm.get('estado')?.invalid && cartaForm.get('estado')?.touched" class="error-message">
        El estado es requerido.
      </div>

      <button type="submit" [disabled]="cartaForm.invalid">Crear Carta</button>
    </form>
  </div>

  <!-- Formulario para editar carta -->
  <div class="form-container" *ngIf="cartaEditada">
    <h2>Editar Carta</h2>
    <form [formGroup]="cartaForm" (ngSubmit)="actualizarCarta()">
      <label for="valorEditado">Valor:</label>
      <input id="valorEditado" formControlName="valor" type="text">
      <div *ngIf="cartaForm.get('valor')?.invalid && cartaForm.get('valor')?.touched" class="error-message">
        El valor es requerido.
      </div>

      <label for="estadoEditado">Estado:</label>
      <select id="estadoEditado" formControlName="estado">
        <option value="cerrado">Cerrado</option>
        <option value="abierto">Abierto</option>
      </select>
      <div *ngIf="cartaForm.get('estado')?.invalid && cartaForm.get('estado')?.touched" class="error-message">
        El estado es requerido.
      </div>

      <div class="button-group">
        <button type="submit" [disabled]="cartaForm.invalid">Actualizar Carta</button>
        <button type="button" (click)="cancelarEdicion()">Cancelar</button>
      </div>
    </form>
  </div>

  <!-- Lista de cartas -->
  <div class="card-list-container">
    <h2>Cartas del Memorama</h2>
    <ul class="card-list">
      <li *ngFor="let carta of cartas">
        <span>{{ carta.valor }} - {{ carta.estado }}</span>
        <div class="actions">
          <button (click)="editarCarta(carta)">Editar</button>
          <button (click)="eliminarCarta(carta.id ?? 0)">Eliminar</button>
        </div>
      </li>
    </ul>
  </div>
</div>

<!-- Modal de confirmación -->
<div *ngIf="mostrarModal" class="modal-overlay">
  <div class="modal-content">
    <p>{{ mensajeModal }}</p>
    <div class="btn-group">
      <button class="btn-confirmar" (click)="confirmarAccion()">Confirmar</button>
      <button class="btn-cancelar" (click)="cerrarModal()">Cancelar</button>
    </div>
  </div>
</div>
